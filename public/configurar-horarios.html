<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configurar Horarios - Quirozen</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #088395;
            margin-bottom: 20px;
        }
        button {
            background: #088395;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #05BFDB;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            color: #0c5460;
        }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚è∞ Configurar Horarios en Firestore</h1>
        
        <div class="info">
            <p><strong>Este script configurar√° los horarios por defecto:</strong></p>
            <ul>
                <li><strong>Lunes a Viernes:</strong> 9:00 - 13:00 y 16:00 - 20:00</li>
                <li><strong>S√°bado:</strong> 9:00 - 13:00</li>
                <li><strong>Domingo:</strong> Cerrado</li>
            </ul>
        </div>

        <button id="configBtn" onclick="configurarHorarios()">üöÄ Configurar Horarios</button>
        <button onclick="verificarHorarios()">üîç Verificar Horarios</button>

        <div id="result"></div>
    </div>

    <script type="module">
        // Importar Firebase desde CDN
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, addDoc, query, where, getDocs, doc, updateDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Configuraci√≥n de Firebase - REEMPLAZA CON TUS VALORES REALES
        // Obt√©n estos valores desde Firebase Console ‚Üí Project Settings ‚Üí Your apps
        const firebaseConfig = {
            apiKey: 'AIzaSyCk4_1vG5Wp7bGZu1_fNrKlIuIsRwZpv4o',
            authDomain: 'quirozenapp.firebaseapp.com',
            projectId: 'quirozenapp',
            storageBucket: 'quirozenapp.firebasestorage.app',
            messagingSenderId: '992779516038',
            appId: '1:992779516038:web:e5d795590c711522f7b907'
        };

        // Inicializar Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Generar slots de tiempo
        function generateTimeSlots(startHour, startMin, endHour, endMin) {
            const slots = [];
            let currentHour = startHour;
            let currentMin = startMin;
            
            while (currentHour < endHour || (currentHour === endHour && currentMin < endMin)) {
                const timeString = `${currentHour.toString().padStart(2, '0')}:${currentMin.toString().padStart(2, '0')}`;
                slots.push(timeString);
                
                currentMin += 30;
                if (currentMin >= 60) {
                    currentMin = 0;
                    currentHour += 1;
                }
            }
            
            return slots;
        }

        // Configuraci√≥n de horarios
        const defaultSchedule = {
            type: 'generic',
            name: 'Horario por defecto',
            isDefault: true,
            weeklySchedule: {
                monday: {
                    available: true,
                    slots: [
                        ...generateTimeSlots(9, 0, 13, 0),
                        ...generateTimeSlots(16, 0, 20, 0)
                    ]
                },
                tuesday: {
                    available: true,
                    slots: [
                        ...generateTimeSlots(9, 0, 13, 0),
                        ...generateTimeSlots(16, 0, 20, 0)
                    ]
                },
                wednesday: {
                    available: true,
                    slots: [
                        ...generateTimeSlots(9, 0, 13, 0),
                        ...generateTimeSlots(16, 0, 20, 0)
                    ]
                },
                thursday: {
                    available: true,
                    slots: [
                        ...generateTimeSlots(9, 0, 13, 0),
                        ...generateTimeSlots(16, 0, 20, 0)
                    ]
                },
                friday: {
                    available: true,
                    slots: [
                        ...generateTimeSlots(9, 0, 13, 0),
                        ...generateTimeSlots(16, 0, 20, 0)
                    ]
                },
                saturday: {
                    available: true,
                    slots: generateTimeSlots(9, 0, 13, 0)
                },
                sunday: {
                    available: false,
                    slots: []
                }
            },
            createdAt: new Date().toISOString(),
            updatedAt: new Date().toISOString()
        };

        // Funci√≥n para configurar horarios
        window.configurarHorarios = async function() {
            const btn = document.getElementById('configBtn');
            const result = document.getElementById('result');
            
            btn.disabled = true;
            btn.textContent = '‚è≥ Configurando...';
            result.innerHTML = '<div class="info">‚è≥ Configurando horarios...</div>';

            try {
                // Verificar si ya existe
                const q = query(
                    collection(db, 'availability'),
                    where('type', '==', 'generic'),
                    where('isDefault', '==', true)
                );
                
                const querySnapshot = await getDocs(q);
                
                if (!querySnapshot.empty) {
                    // Actualizar existente
                    const existingDoc = querySnapshot.docs[0];
                    const docRef = doc(db, 'availability', existingDoc.id);
                    
                    await updateDoc(docRef, {
                        ...defaultSchedule,
                        updatedAt: new Date().toISOString()
                    });
                    
                    result.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ Horarios actualizados exitosamente!</h3>
                            <p>ID del documento: <strong>${existingDoc.id}</strong></p>
                            <p>Los horarios han sido actualizados. Ya puedes hacer reservas.</p>
                        </div>
                    `;
                } else {
                    // Crear nuevo
                    const docRef = await addDoc(collection(db, 'availability'), defaultSchedule);
                    
                    result.innerHTML = `
                        <div class="success">
                            <h3>‚úÖ Horarios configurados exitosamente!</h3>
                            <p>ID del documento: <strong>${docRef.id}</strong></p>
                            <p>Los horarios han sido configurados. Ya puedes hacer reservas.</p>
                        </div>
                    `;
                }
                
                btn.textContent = '‚úÖ Configurado';
            } catch (error) {
                console.error('Error:', error);
                result.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error configurando horarios</h3>
                        <p>${error.message}</p>
                        <p>Verifica que Firestore est√© configurado correctamente.</p>
                    </div>
                `;
                btn.disabled = false;
                btn.textContent = 'üöÄ Configurar Horarios';
            }
        };

        // Funci√≥n para verificar horarios
        window.verificarHorarios = async function() {
            const result = document.getElementById('result');
            result.innerHTML = '<div class="info">üîç Verificando horarios...</div>';

            try {
                const q = query(
                    collection(db, 'availability'),
                    where('type', '==', 'generic'),
                    where('isDefault', '==', true)
                );
                
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    result.innerHTML = `
                        <div class="error">
                            <h3>‚ö†Ô∏è No hay horarios configurados</h3>
                            <p>Haz clic en "Configurar Horarios" para crear la configuraci√≥n.</p>
                        </div>
                    `;
                } else {
                    const config = querySnapshot.docs[0].data();
                    const schedule = config.weeklySchedule;
                    
                    let scheduleText = '<h3>‚úÖ Horarios configurados:</h3><ul>';
                    const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                    const dayNames = ['Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado', 'Domingo'];
                    
                    days.forEach((day, i) => {
                        const daySchedule = schedule[day];
                        if (daySchedule && daySchedule.available) {
                            scheduleText += `<li><strong>${dayNames[i]}:</strong> ${daySchedule.slots.length} horarios disponibles</li>`;
                        } else {
                            scheduleText += `<li><strong>${dayNames[i]}:</strong> Cerrado</li>`;
                        }
                    });
                    
                    scheduleText += '</ul>';
                    scheduleText += `<p><strong>ID:</strong> ${querySnapshot.docs[0].id}</p>`;
                    
                    result.innerHTML = `<div class="success">${scheduleText}</div>`;
                }
            } catch (error) {
                console.error('Error:', error);
                result.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Error verificando horarios</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        };
    </script>
</body>
</html>

